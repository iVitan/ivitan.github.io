<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-144334903-1', 'auto');
ga('send', 'pageview');
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<!-- End Google Analytics -->


    <script data-ad-client="ca-pub-2581760538335948" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    

    



    <meta charset="utf-8">
    
    
    
    <link rel="canonical" href="https://vitan.me/page/8/">
    
    
    <title>Vitan&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Coder,Linux,Web,Blog...">
    <meta name="description" content="Vitan&apos;s Personal Website.">
<meta name="keywords" content="Coder,Linux,Web,Blog...">
<meta property="og:type" content="website">
<meta property="og:title" content="Vitan&#39;s Blog">
<meta property="og:url" content="https://vitan.me/page/8/index.html">
<meta property="og:site_name" content="Vitan&#39;s Blog">
<meta property="og:description" content="Vitan&apos;s Personal Website.">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Vitan&#39;s Blog">
<meta name="twitter:description" content="Vitan&apos;s Personal Website.">
    
        <link rel="alternate" type="application/atom+xml" title="Vitan&#39;s Blog" href="/xml/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.png">
    <link rel="stylesheet" href="/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>
<body>
    <div id="loading" class="active"></div>

    <aside id="menu"  >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/ivitan.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Vitan</h5>
          <a href="mailto:admin@vitan.me" title="admin@vitan.me" class="mail">admin@vitan.me</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-info-circle"></i>
                关于
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/ivitan" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
            <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Vitan&#39;s Blog</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off"
                placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        
        <a href="https://github.com/ivitan" class="header-icon waves-effect waves-circle waves-light" target="_blank" title="Github">
            <i class="icon icon-lg icon-github"></i>
        </a>
        
    </div>
</header>
<header class="content-header index-header">

    <div class="container fade-scale">
        <h1 class="title">Vitan&#39;s Blog</h1>
        <h5 class="subtitle">
            
            ⁣⁣⁣Stay Hungry, Stay Foolish.
            
        </h5>
    </div>

    


</header>

<div class="container body-wrap">

    <ul class="post-list">
    
        <li class="post-list-item fade">
            <article id="post-CatEyeMovice"
    class="article-card article-type-post" itemprop="blogPost">

      <div class="post-meta">
          <time class="post-time" title="2018-10-23 13:09:38" datetime="2018-10-23T05:09:38.000Z"  itemprop="datePublished"><i class="icon icon-calendar"></i> 2018-10-23</time>

          
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Coding/">Coding</a></li></ul>



          
      </div>

      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/posts/CatEyeMovice.html">猫眼电影 Top100</a>
    </h3>
  



      <div class="post-content" id="post-content" itemprop="postContent">

      
          <p>猫眼电影 Top100
&lt;!--more--&gt;</p>
<h1>思路</h1>
<ol>
<li>获取单页网页源代码并返回源代码</li>
<li>解析单页网页源代码，提取 title、actor、time、score 等数据并存储为生成器</li>
<li>将生成器里每一部电影的数据写入txt文档中</li>
<li>研究第 1-10 页 url 的规律，构建 url，调用 1、2、3 步骤</li>
</ol>
<h1>步骤</h1>
<p>获取单页网页源代码并返回源代码
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span><span class="params">(url)</span>:</span></span><br><span class="line">    headers = &#123;<span class="string">'user-agent'</span>: <span class="string">'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.67 Safari/537.36'</span>&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url,headers = headers)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            html = response.text</span><br><span class="line">            <span class="keyword">return</span> html</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> RequestException:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>打印第一页源码</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(get_one_page(<span class="string">'http://maoyan.com/board/4'</span>))</span><br></pre></td></tr></table></figure></p>
<p>解析单页网页源代码，提取title、actor、time、score数据并存储为生成器
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_one_page</span><span class="params">(html)</span>:</span></span><br><span class="line">    pattern = re.compile(<span class="string">'&lt;dd&gt;.*?board-index.*?&gt;(\d+)&lt;/i&gt;'</span></span><br><span class="line">    + <span class="string">'.*?&lt;p.*?title="(.*?)".*?&lt;/p&gt;.*?star"&gt;(.*?)&lt;/p&gt;'</span></span><br><span class="line">    + <span class="string">'.*?releasetime"&gt;(.*?)&lt;/p&gt;.*?integer"&gt;(.*?)'</span></span><br><span class="line">    + <span class="string">'&lt;.*?fraction"&gt;(.*?)&lt;/i&gt;'</span>,re.S)</span><br><span class="line">    movies = re.findall(pattern,html)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> movies:</span><br><span class="line">        <span class="keyword">yield</span>&#123;</span><br><span class="line">            <span class="string">'排名'</span>:item[<span class="number">0</span>],</span><br><span class="line">            <span class="string">'电影名'</span>:item[<span class="number">1</span>],</span><br><span class="line">            <span class="string">'主演'</span>:item[<span class="number">2</span>].strip()[<span class="number">3</span>:],</span><br><span class="line">            <span class="string">'上映时间'</span>:item[<span class="number">3</span>][<span class="number">5</span>:],</span><br><span class="line">            <span class="string">'评分'</span>:item[<span class="number">4</span>]+item[<span class="number">5</span>]</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>注意一下，这里需要用 yield，而不是return。yield函数返回的是一个生成器（一种特殊的迭代器，可以用for循环进行遍历）
如果用return，那么在第一轮循环结束就会跳出，只能获取到一部影片的信息</p>
</blockquote>
<p>将生成器数据写入 txt 文档
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_txt</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="comment"># 采用 append 追加模式，字符集为utf8</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'movies.txt'</span>,<span class="string">'a'</span>,encoding=<span class="string">'utf8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># 采用json的dumps方法来初始化字符串</span></span><br><span class="line">        f.write(json.dumps(content,ensure_ascii=<span class="literal">False</span>) + <span class="string">'\n'</span>)</span><br><span class="line">        f.close()</span><br></pre></td></tr></table></figure></p>
<p>研究第1-10页
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第1-10页url</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">10</span>):</span><br><span class="line">    url = <span class="string">'https://maoyan.com/board/4?offset='</span> + str(i * <span class="number">10</span>)</span><br><span class="line">    <span class="comment"># 构建 url，调用1、2、3步骤</span></span><br><span class="line">    html = get_one_page(url)</span><br><span class="line">    movies= parse_one_page(html)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> movies:</span><br><span class="line">        write_to_txt(item)</span><br></pre></td></tr></table></figure></p>
<h2>多线程保持为 txt</h2>
<ul>
<li>第一步</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span><span class="params">(url)</span>:</span></span><br><span class="line">    headers = &#123;<span class="string">'user-agent'</span>: <span class="string">'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.67 Safari/537.36'</span>&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url,headers = headers)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            html = response.text</span><br><span class="line">            <span class="keyword">return</span> html</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> RequestException:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>第二步</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(offset)</span>:</span></span><br><span class="line">    url = <span class="string">'http://maoyan.com/board/4?offset='</span> + str(offset)</span><br><span class="line">    html = get_one_page(url)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> parse_one_page(html):</span><br><span class="line">        print(item)</span><br><span class="line">        write_to_txt(item)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    pool = Pool() <span class="comment"># 多线程</span></span><br><span class="line">    pool.map(main, [i*<span class="number">10</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)])</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br></pre></td></tr></table></figure></p>
<h1>保持为 CSV</h1>
<h2>单线程</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pandas</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span><span class="params">(url)</span>:</span></span><br><span class="line">    headers = &#123;<span class="string">'user-agent'</span>: <span class="string">'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.67 Safari/537.36'</span>&#125;</span><br><span class="line">    response = requests.get(url,headers = headers)</span><br><span class="line">    html = response.text</span><br><span class="line">    <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_one_page</span><span class="params">(html)</span>:</span></span><br><span class="line">    pageary = []</span><br><span class="line">    pattern = re.compile(<span class="string">'&lt;dd&gt;.*?board-index.*?&gt;(\d+)&lt;/i&gt;'</span></span><br><span class="line">    + <span class="string">'.*?&lt;p.*?title="(.*?)".*?&lt;/p&gt;.*?star"&gt;(.*?)&lt;/p&gt;'</span></span><br><span class="line">    + <span class="string">'.*?releasetime"&gt;(.*?)&lt;/p&gt;.*?integer"&gt;(.*?)'</span></span><br><span class="line">    + <span class="string">'&lt;.*?fraction"&gt;(.*?)&lt;/i&gt;'</span>,re.S)</span><br><span class="line">    movies = re.findall(pattern,html)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> movies:</span><br><span class="line">        dict = &#123;</span><br><span class="line">            <span class="string">'电影名'</span>:item[<span class="number">0</span>],</span><br><span class="line">            <span class="string">'主演'</span>:item[<span class="number">1</span>].strip()[<span class="number">3</span>:],</span><br><span class="line">            <span class="string">'上映时间'</span>:item[<span class="number">2</span>][<span class="number">5</span>:],</span><br><span class="line">            <span class="string">'评分'</span>:item[<span class="number">3</span>]+item[<span class="number">4</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        pageary.append(dict)</span><br><span class="line">    <span class="keyword">return</span> pageary</span><br><span class="line"></span><br><span class="line">ary = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">10</span>):</span><br><span class="line">    url = <span class="string">'https://maoyan.com/board/4?offset='</span> + str(i * <span class="number">10</span>)</span><br><span class="line">    html = get_one_page(url)</span><br><span class="line">    pageary = parse_one_page(html)</span><br><span class="line">    ary = ary + pageary</span><br><span class="line">df = pandas.DataFrame(ary)</span><br><span class="line">df.to_csv(<span class="string">'movies.csv'</span>)</span><br></pre></td></tr></table></figure></p>
<h2>多线程</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pandas</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span><span class="params">(url)</span>:</span></span><br><span class="line">    headers = &#123;<span class="string">'user-agent'</span>: <span class="string">'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.67 Safari/537.36'</span>&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url,headers = headers)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            html = response.text</span><br><span class="line">            <span class="keyword">return</span> html</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> RequestException:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_one_page</span><span class="params">(html)</span>:</span></span><br><span class="line">    pageary = []</span><br><span class="line">    pattern = re.compile(<span class="string">'&lt;dd&gt;.*?board-index.*?&gt;(\d+)&lt;/i&gt;'</span></span><br><span class="line">    + <span class="string">'.*?&lt;p.*?title="(.*?)".*?&lt;/p&gt;.*?star"&gt;(.*?)&lt;/p&gt;'</span></span><br><span class="line">    + <span class="string">'.*?releasetime"&gt;(.*?)&lt;/p&gt;.*?integer"&gt;(.*?)'</span></span><br><span class="line">    + <span class="string">'&lt;.*?fraction"&gt;(.*?)&lt;/i&gt;'</span>,re.S)</span><br><span class="line">    movies = re.findall(pattern,html)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> movies:</span><br><span class="line">        dict = &#123;</span><br><span class="line">            <span class="string">'排名'</span>:item[<span class="number">0</span>],</span><br><span class="line">            <span class="string">'电影名'</span>:item[<span class="number">1</span>],</span><br><span class="line">            <span class="string">'主演'</span>:item[<span class="number">2</span>].strip()[<span class="number">3</span>:],</span><br><span class="line">            <span class="string">'上映时间'</span>:item[<span class="number">3</span>][<span class="number">5</span>:],</span><br><span class="line">            <span class="string">'评分'</span>:item[<span class="number">4</span>]+item[<span class="number">5</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        pageary.append(dict)</span><br><span class="line">    <span class="keyword">return</span> pageary</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_csv</span><span class="params">(pageary)</span>:</span></span><br><span class="line">    ary = []</span><br><span class="line">    ary = ary + pageary</span><br><span class="line">    df = pandas.DataFrame(ary)</span><br><span class="line">    df.to_csv(<span class="string">'movies.csv'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(offset)</span>:</span></span><br><span class="line">    url = <span class="string">'https://maoyan.com/board/4?offset='</span> + str(offset)</span><br><span class="line">    pageary = parse_one_page(html)</span><br><span class="line">    write_to_csv(ary)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    pool = Pool()</span><br><span class="line">    pool.map(main, [i*<span class="number">10</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)])</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br></pre></td></tr></table></figure></p>

      

          <a href="/posts/CatEyeMovice.html" class="post-more waves-effect waves-button">
            <i class="icon icon-bookmark">&nbsp;</i> 阅读全文…
          </a>
      </div>
      
      <div class="post-footer">
          
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Note/">Note</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebCrawler/">WebCrawler</a></li></ul>

      </div>
      
  </article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-PythonDateTime"
    class="article-card article-type-post" itemprop="blogPost">

      <div class="post-meta">
          <time class="post-time" title="2018-10-22 14:40:50" datetime="2018-10-22T06:40:50.000Z"  itemprop="datePublished"><i class="icon icon-calendar"></i> 2018-10-22</time>

          
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Coding/">Coding</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Coding/Python/">Python</a></li></ul></li></ul>



          
      </div>

      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/posts/PythonDateTime.html">Python 时间日期处理</a>
    </h3>
  



      <div class="post-content" id="post-content" itemprop="postContent">

      
          <p>Python DateTime 时间日期处理.
&lt;!--more--&gt;</p>
<h1>DateTime</h1>
<h2>获取当前 DateTime</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime timport datetime</span><br><span class="line">datetime.datetime.now()</span><br></pre></td></tr></table></figure></p>
<h2>获取当天 date</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">datetime.date.today()</span><br></pre></td></tr></table></figure></p>
<h2>获取明天/前N天</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 明天</span></span><br><span class="line">atetime.date.today() + datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 前N天</span></span><br><span class="line">datetime.datetime.now()</span><br><span class="line">datetime.datetime.now() - datetime.timedelta(days=<span class="number">3</span>)</span><br></pre></td></tr></table></figure></p>
<h2>获取当天开始和结束时间</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">datetime.datetime.combine(datetime.date.today(), datetime.time.min)</span><br><span class="line">datetime.datetime.combine(datetime.date.today(), datetime.time.max)</span><br></pre></td></tr></table></figure></p>
<h2>获取两个 datetime 的时间差</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">now = datetime.now()</span><br><span class="line">end = datetime.strptime(<span class="string">'2018-10-25 22:00'</span>,<span class="string">'%Y-%m-%d %H:%M'</span>)</span><br><span class="line">time = end - now</span><br><span class="line">print(time.days,<span class="string">'天'</span>)</span><br></pre></td></tr></table></figure></p>
<h2>获取本周/本月/上月最后一天</h2>
<ul>
<li>本周最后一天</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">today = datetime.date.today()</span><br><span class="line">sunday = today + datetime.timedelta(<span class="number">6</span> - today.weekday())</span><br><span class="line">sunday</span><br></pre></td></tr></table></figure></p>
<ul>
<li>本月最后一天</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> calendar</span><br><span class="line">today = datetime.date.today()</span><br><span class="line">last_day_num = calendar.monthrange(today.year, today.month)</span><br><span class="line">last_day = datetime.date(today.year, today.month, last_day_num)</span><br><span class="line">last_day</span><br></pre></td></tr></table></figure></p>
<ul>
<li>上月最后一天</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">today = datetime.date.today()</span><br><span class="line">first = datetime.date(day=<span class="number">1</span>, month=today.month, year=today.year)</span><br><span class="line">lastMonth = first - datetime.timedelta(days=<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<h1>转换</h1>
<h2>datetime &lt;=&gt; string</h2>
<ul>
<li>datetime -&gt; string</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">datetime.datetime.now().strftime(<span class="string">"%Y-%m-%d %H:%M:%S"</span>)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>string -&gt; datetime</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">datetime.datetime.strptime(<span class="string">"2018-10-22 12:50:46"</span>, <span class="string">"%Y-%m-%d %H:%M:%S"</span>)</span><br></pre></td></tr></table></figure></p>
<h2>datetime &lt;=&gt; timetuple</h2>
<ul>
<li>datetime -&gt; timetuple</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">datetime.datetime.now().timetuple()</span><br></pre></td></tr></table></figure></p>
<ul>
<li>timetuple -&gt; datetime</li>
</ul>
<p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timetuple =&gt; timestamp =&gt; datetime [看后面datetime&lt;=&gt;timestamp]</span><br></pre></td></tr></table></figure></p>
<h2>datetime &lt;=&gt; date</h2>
<ul>
<li>datetime -&gt; date</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">datetime.datetime.now().date()</span><br></pre></td></tr></table></figure></p>
<ul>
<li>date -&gt; datetime</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">datetime.date.today()</span><br><span class="line">today = datetime.date.today()</span><br><span class="line">datetime.datetime.combine(today, datetime.time())</span><br><span class="line">datetime.datetime.combine(today, datetime.time.min)</span><br></pre></td></tr></table></figure></p>
<h2>datetime &lt;=&gt; timestamp</h2>
<ul>
<li>datetime -&gt; timestamp</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">now = datetime.datetime.now()</span><br><span class="line">timestamp = time.mktime(now.timetuple())</span><br><span class="line">timestamp</span><br></pre></td></tr></table></figure></p>
<h2>timestamp -&gt; datetime</h2>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">datetime.datetime.fromtimestamp(1421077403.0)</span><br></pre></td></tr></table></figure></p>
<hr>
<p><strong>Via</strong></p>
<ul>
<li><a href="http://www.wklken.me/posts/2015/03/03/python-base-datetime.html" target="_blank" rel="noopener">PYTHON-基础-时间日期处理小结</a></li>
</ul>

      

          <a href="/posts/PythonDateTime.html" class="post-more waves-effect waves-button">
            <i class="icon icon-bookmark">&nbsp;</i> 阅读全文…
          </a>
      </div>
      
      <div class="post-footer">
          
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Note/">Note</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebCrawler/">WebCrawler</a></li></ul>

      </div>
      
  </article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-LinuxHome"
    class="article-card article-type-post" itemprop="blogPost">

      <div class="post-meta">
          <time class="post-time" title="2018-10-19 12:15:15" datetime="2018-10-19T04:15:15.000Z"  itemprop="datePublished"><i class="icon icon-calendar"></i> 2018-10-19</time>

          
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux/">Linux</a></li></ul>



          
      </div>

      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/posts/LinuxHome.html">Linux 逻辑卷分区大小的调整</a>
    </h3>
  



      <div class="post-content" id="post-content" itemprop="postContent">

      
          <p>Linux <code>Home</code> 硬盘空间缩减并添加到 <code>/</code>.
&lt;!--more--&gt;</p>
<h1>看硬盘信息</h1>
<h2>f -l</h2>
<p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df -l</span><br></pre></td></tr></table></figure></p>
<hr>
<table>
<thead>
<tr>
<th style="text-align:left">文件系统</th>
<th style="text-align:left">容量</th>
<th style="text-align:left">已用</th>
<th style="text-align:left">可用</th>
<th style="text-align:left">已用%</th>
<th style="text-align:left">挂载点</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">dev</td>
<td style="text-align:left">1.9G</td>
<td style="text-align:left">0</td>
<td style="text-align:left">1.9G</td>
<td style="text-align:left">0%</td>
<td style="text-align:left">/dev</td>
</tr>
<tr>
<td style="text-align:left">run</td>
<td style="text-align:left">1.9G</td>
<td style="text-align:left">1.3M</td>
<td style="text-align:left">1.9G</td>
<td style="text-align:left">1%</td>
<td style="text-align:left">/run</td>
</tr>
<tr>
<td style="text-align:left">/dev/sdb4</td>
<td style="text-align:left">30G</td>
<td style="text-align:left">17G</td>
<td style="text-align:left">12G</td>
<td style="text-align:left">59%</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left">/dev/sdb3</td>
<td style="text-align:left">59G</td>
<td style="text-align:left">8.6G</td>
<td style="text-align:left">48G</td>
<td style="text-align:left">16%</td>
<td style="text-align:left">/home</td>
</tr>
</tbody>
</table>
<h1>缩减 Home</h1>
<h2>卸载 Home 挂载</h2>
<p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount /home</span><br></pre></td></tr></table></figure></p>
<ul>
<li>提示 busy 不能卸载</li>
</ul>
<p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 终止占用进程</span></span><br><span class="line">fuser -m /home</span><br></pre></td></tr></table></figure></p>
<h2>调整 /home 分区大小</h2>
<p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resize2fs -p /dev/sdb3  30G</span><br><span class="line"><span class="comment"># resize2fs 为重新设定磁盘大小</span></span><br><span class="line"><span class="comment"># 只是重新指定一下大小，并不对结果有影响</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>先设置一下 Home 的大小,进行这一步的时候会提醒让先运行下面的命令进行检查</li>
</ul>
<p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e2fsck -f /dev/sdb3</span><br></pre></td></tr></table></figure></p>
<ul>
<li>强制检查一下磁盘并修复错误，接下来再次运行这个命令把 home大小设置为20G</li>
</ul>
<p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resize2fs -p /dev/sdb3 30G</span><br></pre></td></tr></table></figure></p>
<ul>
<li>收缩逻辑卷空间为 30G</li>
</ul>
<p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用lvreduce指令用于减少LVM逻辑卷占用的空间大小</span></span><br><span class="line"><span class="comment"># -L 是设为，-l 是减小的值</span></span><br><span class="line">lvreduce -L 30G /dev/sdb3</span><br></pre></td></tr></table></figure></p>
<ul>
<li>然后挂载 <code>/home</code> 并 <code>df -h</code> 查看一下 Home 大小分配是否成功</li>
</ul>
<p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /home</span><br></pre></td></tr></table></figure></p>
<h1>分配给 /</h1>
<p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvextend -l +100%FREE /dev/sdb4</span><br></pre></td></tr></table></figure></p>
<ul>
<li>执行调整根目录的空间大小,并耐心等待,不要操作</li>
</ul>
<p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resize2fs -p /dev/sdb4</span><br></pre></td></tr></table></figure></p>
<h1>注意</h1>
<ol>
<li><code>ext2</code> <code>ext3</code> <code>ext4</code> 文件系统的调整命令是 <code>resize2fs</code></li>
<li><code>xfs</code> 文件系统的调整命令是 <code>xfs_growfs</code>（只支持增大）</li>
</ol>
<hr>
<p><strong>参考</strong></p>
<ul>
<li><a href="http://www.manongjc.com/article/14263.html" target="_blank" rel="noopener">Linux的中对LVM逻辑卷分区大小的调整教程</a></li>
</ul>

      

          <a href="/posts/LinuxHome.html" class="post-more waves-effect waves-button">
            <i class="icon icon-bookmark">&nbsp;</i> 阅读全文…
          </a>
      </div>
      
      <div class="post-footer">
          
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ArchLinux/">ArchLinux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Note/">Note</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ubuntu/">Ubuntu</a></li></ul>

      </div>
      
  </article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-PythonSelenium"
    class="article-card article-type-post" itemprop="blogPost">

      <div class="post-meta">
          <time class="post-time" title="2018-10-17 15:24:49" datetime="2018-10-17T07:24:49.000Z"  itemprop="datePublished"><i class="icon icon-calendar"></i> 2018-10-17</time>

          
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Coding/">Coding</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Coding/Python/">Python</a></li></ul></li></ul>



          
      </div>

      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/posts/PythonSelenium.html">Python Selenium</a>
    </h3>
  



      <div class="post-content" id="post-content" itemprop="postContent">

      
          <p>Python Selenium 基础使用。
&lt;!--more--&gt;</p>
<h1>基本使用</h1>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建Chrome浏览器对象browser</span></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment">#用get方式访问百度首页</span></span><br><span class="line">    browser.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">    <span class="comment">#通过id为‘kw’找到输入框input</span></span><br><span class="line">    input = browser.find_element_by_id(<span class="string">'kw'</span>)</span><br><span class="line">    <span class="comment">#调用该输入框的send_keys方法向输入框键入“Python”关键词</span></span><br><span class="line">    input.send_keys(<span class="string">'Python'</span>)</span><br><span class="line">    <span class="comment">#高用该输入框的send_keys方法向输入框按回车键</span></span><br><span class="line">    input.send_keys(Keys.ENTER)</span><br><span class="line">    <span class="comment">#创建浏览器等待对象wait,等待时间10称</span></span><br><span class="line">    wait = WebDriverWait(browser,<span class="number">10</span>)</span><br><span class="line">    <span class="comment">#调用wait的until方法，直到ID为content_left（即搜索结果界面）元素出现</span></span><br><span class="line">    wait.until(EC.presence_of_element_located((By.ID, <span class="string">'content_left'</span>)))</span><br><span class="line">    <span class="comment">#打印输出浏览器当前的URL</span></span><br><span class="line">    print(browser.current_url)</span><br><span class="line">    <span class="comment">#打印输出当前的cookies信息</span></span><br><span class="line">    print(browser.get_cookies)</span><br><span class="line">    <span class="comment">#打印输出网页源代码</span></span><br><span class="line">    print(browser.page_source)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="comment">#关闭浏览器</span></span><br><span class="line">    browser.close()</span><br></pre></td></tr></table></figure></p>
<h2>声明浏览器对象</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser = webdriver.Firefox()</span><br><span class="line">browser = webdriver.Edge()</span><br><span class="line">browser = webdriver.PhantomJS()</span><br><span class="line">browser = webdriver.Safari()</span><br></pre></td></tr></table></figure></p>
<h2>访问页面</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建Chrome浏览器对象</span></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="comment">#访问淘宝首页</span></span><br><span class="line">browser.get(<span class="string">'https://taobao.com'</span>)</span><br><span class="line"><span class="comment">#打印输出网页源代码</span></span><br><span class="line">print(browser.page_source)</span><br><span class="line"><span class="comment">#关闭浏览器</span></span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure></p>
<h1>查找元素</h1>
<h2>单个</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建Chrome浏览器对象</span></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="comment">#访问淘宝首页</span></span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line"><span class="comment">#通过id属性查找id为q的元素,即为搜索输入框,命名为input_first</span></span><br><span class="line">input_first = browser.find_element_by_id(<span class="string">'q'</span>)</span><br><span class="line"><span class="comment">#通过css选择器查找搜索输入框,命名为input_second</span></span><br><span class="line">input_second = browser.find_element_by_css_selector(<span class="string">'#q'</span>)</span><br><span class="line"><span class="comment">#通过xpath查找搜索输入框，命名为input_third</span></span><br><span class="line">input_third = browser.find_element_by_xpath(<span class="string">'//*[@id="q"]'</span>)</span><br><span class="line"><span class="comment">#打印输出以上三个查找结果</span></span><br><span class="line">print(input_first,input_second,input_third)</span><br><span class="line"><span class="comment">#关闭浏览器</span></span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">input_first = browser.find_element(By.ID, <span class="string">'q'</span>)</span><br><span class="line">print(input_first)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure></p>
<h2>多个元素</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建Chrome浏览器对象 browser</span></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="comment">#get方式访问淘宝首页</span></span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line"><span class="comment">#(多个元素用elements，须借助css_selector)查找淘宝首页左边导航条下面的class为service-bd的ul标签下面的名为li的多个标签</span></span><br><span class="line">lis = browser.find_elements_by_css_selector(<span class="string">'.service-bd'</span>)</span><br><span class="line"><span class="comment">#打印输出所有lis元素</span></span><br><span class="line">print(lis)</span><br><span class="line"><span class="comment">#关闭浏览器</span></span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">lis = browser.find_elements(By.CSS_SELECTOR, <span class="string">'.service-bd li'</span>)<span class="comment">#作用同上</span></span><br><span class="line">print(lis)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure></p>
<h1>元素交互操作</h1>
<h2>对获取的元素调用交互方法</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建chrome浏览器对象</span></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="comment">#访问淘宝首页</span></span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line"><span class="comment">#查找id为q的搜索输入框input</span></span><br><span class="line">input = browser.find_element_by_id(<span class="string">'q'</span>)</span><br><span class="line"><span class="comment">#调用input的send_keys函数向输入框输入关键字“OnePLus”</span></span><br><span class="line">input.send_keys(<span class="string">'OnePlus'</span>)</span><br><span class="line"><span class="comment">#当前浏览器暂停1S</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#清除输入框的内容</span></span><br><span class="line">input.clear()</span><br><span class="line"><span class="comment">#调用input的send_keys再次输入 一加</span></span><br><span class="line">input.send_keys(<span class="string">'一加'</span>)</span><br><span class="line"><span class="comment">#查找class为btn-search的搜索按钮并命名为button 用find_element_by_class_name</span></span><br><span class="line">button = browser.find_element_by_class_name(<span class="string">'btn-search'</span>)</span><br><span class="line"><span class="comment">#调用click点击该按钮</span></span><br><span class="line">button.click()</span><br></pre></td></tr></table></figure></p>
<ul>
<li><a href="http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.remote.webelement" target="_blank" rel="noopener">更多操作</a></li>
</ul>
<h1>交互动作</h1>
<h2>将动作附加到动作链中串行执行</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建chrome浏览器对象browser</span></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="comment">#设置url为http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable</span></span><br><span class="line">url = <span class="string">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span></span><br><span class="line"><span class="comment">#用get方式访问以上url</span></span><br><span class="line">browser.get(url)</span><br><span class="line"><span class="comment">#在浏览器中切换定位到名为iframeResult的frame元素</span></span><br><span class="line">browser.switch_to.frame(<span class="string">'iframeResult'</span>)</span><br><span class="line"><span class="comment">#通过css选择器查找id为draggable的拖曳源，并命名为source</span></span><br><span class="line">source = browser.find_element_by_css_selector(<span class="string">'#draggable'</span>)</span><br><span class="line"><span class="comment">#通过css选择器查找id为droppable的代入源，并命名为target</span></span><br><span class="line">target = browser.find_element_by_css_selector(<span class="string">'#droppable'</span>)</span><br><span class="line"><span class="comment">#用ActionChains函数创建浏览器动作链对象actions</span></span><br><span class="line">actions = ActionChains(browser)</span><br><span class="line"><span class="comment">#调用actions的drag_and_drop,设计将source放入target的动作</span></span><br><span class="line">actions.drag_and_drop(source,target)</span><br><span class="line"><span class="comment">#调用perform执行该动作</span></span><br><span class="line">actions.perform()</span><br><span class="line"><span class="comment">#关闭浏览器</span></span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure></p>
<ul>
<li><a href="http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.common.action_chains" target="_blank" rel="noopener">更多操作</a></li>
</ul>
<h2>执行 JavaScript</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建chrome()浏览器对象browser</span></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="comment">#get方式访问https://www.zhihu.com/explore网页</span></span><br><span class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</span><br><span class="line"><span class="comment">#利用execute_script执行js语句window.scrollTo(0, document.body.scrollHeight)</span></span><br><span class="line">browser.execute_script(<span class="string">'window.scrollTo(0, document.body.scrollHeight)'</span>)</span><br><span class="line"><span class="comment">##利用execute_script执行js语句alert("To Bottom")警报信息,注意，execute_script('')里面的js加引号</span></span><br><span class="line">browser.execute_script(<span class="string">'alert("To Bottom")'</span>)</span><br></pre></td></tr></table></figure></p>
<h1>获取元素信息</h1>
<h2>获取属性</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建Chrome浏览器对象browser</span></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="comment">#设置url为https://www.zhihu.com/explore</span></span><br><span class="line">url = <span class="string">'https://www.zhihu.com/explore'</span></span><br><span class="line"><span class="comment">#get方式访问以上网址</span></span><br><span class="line">browser.get(url)</span><br><span class="line"><span class="comment">#查找id为zh-top-link-logo的元素并命名为logo(知乎logo)</span></span><br><span class="line">logo = browser.find_element_by_id(<span class="string">'zh-top-link-logo'</span>)</span><br><span class="line"><span class="comment">#打印输出此logo</span></span><br><span class="line">print(logo)</span><br><span class="line"><span class="comment">#打印输出：用logo的get_attribute函数获得logo的class属性值</span></span><br><span class="line">print(logo.get_attribute(<span class="string">'class'</span>))</span><br></pre></td></tr></table></figure></p>
<h2>获取文本值</h2>
<ul>
<li>获取指定节点中的文本内容</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element_by_xpath(<span class="string">''</span>).get_attribute(<span class="string">'textContent'</span>)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>获取a的href(多个则遍历)</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">broswer.find_element_by_css_selector(<span class="string">'.houseListTitle a'</span>).get_attribute(<span class="string">'href'</span>)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>输入框的文本</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">url = <span class="string">'https://www.zhihu.com/explore'</span></span><br><span class="line">browser.get(url)</span><br><span class="line"><span class="comment">#利用by_class_name查找class属性值为zu-top-add-question的输入框input</span></span><br><span class="line">input = browser.find_element_by_class_name(<span class="string">'zu-top-add-question'</span>)</span><br><span class="line"><span class="comment">#输出打印该输入框的文本（text）</span></span><br><span class="line">print(input.text)</span><br></pre></td></tr></table></figure></p>
<h2>获取ID、位置、标签名、大小</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="comment">#设置url为https://www.zhihu.com/explore</span></span><br><span class="line">url = <span class="string">'https://www.zhihu.com/explore'</span></span><br><span class="line"><span class="comment">#用get方式访问以上网址</span></span><br><span class="line">browser.get(url)</span><br><span class="line"><span class="comment">#查找class属性值为zu-top-add-question的输入框input</span></span><br><span class="line">input = browser.find_element_by_class_name(<span class="string">'zu-top-add-question'</span>)</span><br><span class="line"><span class="comment">#打印输出input的id</span></span><br><span class="line">print(input.id)</span><br><span class="line"><span class="comment">#打印输出input的位置location</span></span><br><span class="line">print(input.location)</span><br><span class="line"><span class="comment">#打印输出input的标签名tag_name</span></span><br><span class="line">print(input.tag_name)</span><br><span class="line"><span class="comment">#打印输出input的对象几何大小size</span></span><br><span class="line">print(input.size)</span><br></pre></td></tr></table></figure></p>
<h2>Frame</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> NoSuchElementException</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">url = <span class="string">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span></span><br><span class="line">browser.get(url)</span><br><span class="line">browser.switch_to.frame(<span class="string">'iframeResult'</span>)</span><br><span class="line">source = browser.find_element_by_css_selector(<span class="string">'#draggable'</span>)</span><br><span class="line">print(source)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    logo = browser.find_element_by_class_name(<span class="string">'logo'</span>)</span><br><span class="line"><span class="keyword">except</span> NoSuchElementException:</span><br><span class="line">    print(<span class="string">'NO LOGO'</span>)</span><br><span class="line">browser.switch_to.parent_frame()</span><br><span class="line">logo = browser.find_element_by_class_name(<span class="string">'logo'</span>)</span><br><span class="line">print(logo)</span><br><span class="line">print(logo.text)</span><br></pre></td></tr></table></figure></p>
<h1>等待</h1>
<h2>隐式等待</h2>
<ul>
<li>当使用了隐式等待执行测试的时候，如果 WebDriver 没有在 DOM 中找到元素，将继续等待，超出设定时间后则抛出找不到元素的异常, 换句话说，当查找元素或元素并没有立即出现的时候，隐式等待将等待一段时间再查找 DOM，默认的时间是 0</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="comment">#利用implicitly_wait进行隐式等待，等待时间设置为10S</span></span><br><span class="line">browser.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</span><br><span class="line">input = browser.find_element_by_class_name(<span class="string">'zu-top-add-question'</span>)</span><br><span class="line">print(input)</span><br></pre></td></tr></table></figure></p>
<h2>显式等待</h2>
<ul>
<li>显示等待则打指定等待不固定，具体时间受指定的元素出现或其他条件实现的时间限制</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line">​</span><br><span class="line"><span class="comment">#创建浏览器对象</span></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="comment">#利用get方式访问淘宝首页</span></span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line"><span class="comment">#创建浏览器等待对象wait，默认为10秒</span></span><br><span class="line">wait = WebDriverWait(browser,<span class="number">10</span>)</span><br><span class="line"><span class="comment">#创建input对象，利用wait.until函数直到id为q的元素加载完后,注意By.ID参数双括号</span></span><br><span class="line">input = wait.until(EC.presence_of_element_located((By.ID, <span class="string">'q'</span>)))</span><br><span class="line"><span class="comment">#创建button对象，利用wait.until直到class为btn-search</span></span><br><span class="line">button = wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR, <span class="string">'.btn-search'</span>)))</span><br><span class="line"><span class="comment">#打印输出input,button</span></span><br><span class="line">print(input,button)</span><br></pre></td></tr></table></figure></p>
<h1>前进后退</h1>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="comment">#访问百度</span></span><br><span class="line">browser.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"><span class="comment">#访问淘宝</span></span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line"><span class="comment">#访问python主页https://www.python.org/(被GWF铁拳重创，故改为qq.com)</span></span><br><span class="line">browser.get(<span class="string">'https://www.qq.com'</span>)</span><br><span class="line"><span class="comment">#调用浏览器的back函数执行返回。问：返回到哪一个网页？</span></span><br><span class="line">browser.back()</span><br><span class="line"><span class="comment">#当前休眠3s</span></span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"><span class="comment">#浏览器前进。问，前进到哪一网页？</span></span><br><span class="line">browser.forward()</span><br><span class="line"><span class="comment">#关闭浏览器</span></span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure></p>
<h1>Cookies</h1>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">​</span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</span><br><span class="line"><span class="comment">#get_cookies获取cookies并输出打印</span></span><br><span class="line">print(browser.get_cookies())</span><br><span class="line">print(<span class="string">'------------------------------------------------------------------------------------------------------'</span>)</span><br><span class="line"><span class="comment">#add_cookie（注意此cookie单词没有s）增加cookies&#123;'name': 'name', 'domain': 'www.zhihu.com', 'value': 'germey'&#125;</span></span><br><span class="line">browser.add_cookie(&#123;<span class="string">'name'</span>: <span class="string">'name'</span>, <span class="string">'domain'</span>: <span class="string">'www.zhihu.com'</span>, <span class="string">'value'</span>: <span class="string">'germey'</span>&#125;)</span><br><span class="line"><span class="comment">#重新获取cookies并输出打印</span></span><br><span class="line">print(browser.get_cookies())</span><br><span class="line">print(<span class="string">'------------------------------------------------------------------------------------------------------'</span>)</span><br><span class="line"><span class="comment">#delete_all_cookies删除所有cookies</span></span><br><span class="line">browser.delete_all_cookies()</span><br><span class="line"><span class="comment">#重新获取cookies并输出打印</span></span><br><span class="line">print(browser.get_cookies())</span><br></pre></td></tr></table></figure></p>
<h1>选项卡管理</h1>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建浏览器对象</span></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="comment">#访问淘宝</span></span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line"><span class="comment">#打开新的选项卡（执行js语句 execute_script（'window.open()')</span></span><br><span class="line">browser.execute_script(<span class="string">'window.open()'</span>)</span><br><span class="line"><span class="comment">#打印输出当前浏览器对象browser.window_handles</span></span><br><span class="line">print(browser.window_handles)</span><br><span class="line"><span class="comment">#切换到第2个选项卡,下标为1</span></span><br><span class="line">browser.switch_to.window(browser.window_handles[<span class="number">1</span>])</span><br><span class="line"><span class="comment">#访问 百度</span></span><br><span class="line">browser.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"><span class="comment">#休眠1s</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#切换到第1个选项卡，下标为0</span></span><br><span class="line">browser.switch_to.window(browser.window_handles[<span class="number">0</span>])</span><br><span class="line"><span class="comment">#访问百度</span></span><br><span class="line">browser.get(<span class="string">'https://www.vitan.me'</span>)</span><br></pre></td></tr></table></figure></p>
<h1>异常处理</h1>
<h2>未处理</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">    ​</span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">browser.find_element_by_id(<span class="string">'hello'</span>)</span><br></pre></td></tr></table></figure></p>
<h2>处理后</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException, NoSuchElementException</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    browser.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"><span class="keyword">except</span> TimeoutException:</span><br><span class="line">    print(<span class="string">'Time Out'</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    browser.find_element_by_id(<span class="string">'hello'</span>)</span><br><span class="line"><span class="keyword">except</span> NoSuchElementException:</span><br><span class="line">    print(<span class="string">'No Element'</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    browser.close()</span><br></pre></td></tr></table></figure></p>

      

          <a href="/posts/PythonSelenium.html" class="post-more waves-effect waves-button">
            <i class="icon icon-bookmark">&nbsp;</i> 阅读全文…
          </a>
      </div>
      
      <div class="post-footer">
          
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Note/">Note</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebCrawler/">WebCrawler</a></li></ul>

      </div>
      
  </article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-LinuxPythonChromedriver"
    class="article-card article-type-post" itemprop="blogPost">

      <div class="post-meta">
          <time class="post-time" title="2018-10-16 12:21:43" datetime="2018-10-16T04:21:43.000Z"  itemprop="datePublished"><i class="icon icon-calendar"></i> 2018-10-16</time>

          
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Coding/">Coding</a></li></ul>



          
      </div>

      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/posts/LinuxPythonChromedriver.html">Python ChromeDriver GeckoDriver</a>
    </h3>
  



      <div class="post-content" id="post-content" itemprop="postContent">

      
          <p>Python ChromeDriver GeckoDriver Configer
&lt;!--more--&gt;</p>
<h1>下载</h1>
<ul>
<li><a href="http://chromedriver.chromium.org/downloads" target="_blank" rel="noopener">ChromeDriver</a></li>
<li><a href="https://github.com/mozilla/geckodriver/releases" target="_blank" rel="noopener">GeckoDriver</a></li>
</ul>
<h1>配置</h1>
<h2>Linux</h2>
<ul>
<li>方法一</li>
</ul>
<p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mv chromedriver /usr/bin</span><br><span class="line">sudo mv geckodriver /usr/bin</span><br></pre></td></tr></table></figure></p>
<h2>方法二(配置 Path)</h2>
<p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">"<span class="variable">$PATH</span>:/usr/local/chromedriver"</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">"<span class="variable">$PATH</span>:/usr/local/geckodriver"</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>验证</li>
</ul>
<p><figure class="highlight sh"><figcaption><span>terminal</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chromedriver</span><br><span class="line">geckodriver</span><br></pre></td></tr></table></figure></p>
<h2>Windows</h2>
<p>chromedriver.exe geckodriver.exe 文件拖到 Python 的 Scripts 目录下</p>

      

          <a href="/posts/LinuxPythonChromedriver.html" class="post-more waves-effect waves-button">
            <i class="icon icon-bookmark">&nbsp;</i> 阅读全文…
          </a>
      </div>
      
      <div class="post-footer">
          
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ArchLinux/">ArchLinux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebCrawler/">WebCrawler</a></li></ul>

      </div>
      
  </article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-PythonWorldFrequency"
    class="article-card article-type-post" itemprop="blogPost">

      <div class="post-meta">
          <time class="post-time" title="2018-10-15 18:24:55" datetime="2018-10-15T10:24:55.000Z"  itemprop="datePublished"><i class="icon icon-calendar"></i> 2018-10-15</time>

          
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Coding/">Coding</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Coding/Python/">Python</a></li></ul></li></ul>



          
      </div>

      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/posts/PythonWorldFrequency.html">Python 中英词频统计</a>
    </h3>
  



      <div class="post-content" id="post-content" itemprop="postContent">

      
          <p>Python 中英文词频统计，并制作词云。
&lt;!-- more --&gt;</p>
<h1>英文词频</h1>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="comment"># Author: Vitan</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'cp.txt'</span>,<span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">content = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清洗数据</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">content = content.lower()  <span class="comment"># 格式化数据，转为小写</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> string.punctuation:  <span class="comment"># 去除所有标点符号</span></span><br><span class="line">    content = content.replace(i, <span class="string">' '</span>)</span><br><span class="line">wordList = content.split()  <span class="comment"># 切片分词</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 排除语法型词汇，代词、冠词、连词等无语义词</span></span><br><span class="line">noMean = &#123;<span class="string">'a'</span>,<span class="string">'an'</span>,<span class="string">'the'</span>,<span class="string">'i'</span>,<span class="string">'do'</span>,<span class="string">'am'</span>,<span class="string">'you'</span>,<span class="string">'no'</span>,<span class="string">'t'</span>,<span class="string">'m'</span>,<span class="string">'d'</span>,<span class="string">'ve'</span>&#125;</span><br><span class="line">wordSet = set(wordList) - noMean</span><br><span class="line">wordList = list(wordSet)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计单词数量</span></span><br><span class="line">data = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> wordList:</span><br><span class="line"><span class="comment">#data[word] = data.get(word, 0) + 1</span></span><br><span class="line">    data[word] = wordList.count(word)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> data:</span><br><span class="line">    print(key,data[key],<span class="string">'次'</span>)</span><br><span class="line">print(<span class="string">"============"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># list.sort() 排序</span></span><br><span class="line">wordList = list(data.items())</span><br><span class="line"><span class="comment"># 函数定义</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">def takeSecond(elem): # 定义函数，获取每个单词的次数项</span></span><br><span class="line"><span class="string">return elem[1]</span></span><br><span class="line"><span class="string">wordList.sort(key = takeSecond,reverse = True)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># 匿名函数</span></span><br><span class="line">wordList.sort(key = <span class="keyword">lambda</span> x:x[<span class="number">1</span>],reverse = <span class="literal">True</span>)</span><br><span class="line">print(wordList)</span><br><span class="line">print(<span class="string">"============"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序</span></span><br><span class="line">hist = []</span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> data.items():</span><br><span class="line">    hist.append([value, key])</span><br><span class="line">hist.sort(reverse = <span class="literal">True</span>)  <span class="comment"># 降序</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 前20个</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">    print(hist[i])</span><br></pre></td></tr></table></figure></p>
<h1>中文词频</h1>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="comment"># Author: Vitan</span></span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span>  wordcloud <span class="keyword">import</span> WordCloud</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取文件内容</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'ch.txt'</span>,<span class="string">'r'</span>,encoding = <span class="string">'UTF-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">content = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结巴分词</span></span><br><span class="line">wordList = jieba.cut(content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 词频统计</span></span><br><span class="line">data = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> wordList:</span><br><span class="line">    <span class="keyword">if</span> len(word)==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:data[word]=data.get(word,<span class="number">0</span>)+<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 匿名函数获取每个单词的次数项统，降序</span></span><br><span class="line">result = list(data.items())</span><br><span class="line">result.sort(key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>],reverse=<span class="literal">True</span>) <span class="comment"># 排序</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">    print(result[i])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置词云</span></span><br><span class="line">wordSplit = <span class="string">" "</span>.join(dict(result))</span><br><span class="line">wc = WordCloud(background_color=<span class="string">"black"</span>,  <span class="comment"># 设置背景颜色</span></span><br><span class="line">           <span class="comment"># mask = "图片",  #设置背景图片</span></span><br><span class="line">           max_words=<span class="number">2000</span>,  <span class="comment"># 设置最大显示的字数</span></span><br><span class="line">           <span class="comment"># stopwords = "", #设置停用词</span></span><br><span class="line">           font_path=<span class="string">"/usr/share/fonts/noto-cjk/NotoSansCJK-Medium.ttc"</span>,</span><br><span class="line">           <span class="comment"># 设置中文字体，使得词云可以显示（词云默认字体是“DroidSansMono.ttf字体库”，不支持中文）</span></span><br><span class="line">           max_font_size=<span class="number">50</span>,  <span class="comment"># 设置字体最大值</span></span><br><span class="line">           random_state=<span class="number">30</span>,  <span class="comment"># 设置有多少种随机生成状态，即有多少种配色方案</span></span><br><span class="line">           )</span><br><span class="line">mywc = wc.generate(wordSplit)  <span class="comment"># 生成词云</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 展示词云图</span></span><br><span class="line">plt.imshow(mywc)</span><br><span class="line">plt.axis(<span class="string">"off"</span>)</span><br><span class="line">plt.show()</span><br><span class="line">wc.to_file(<span class="string">'mywor.png'</span>)  <span class="comment"># 保存图片文件</span></span><br></pre></td></tr></table></figure></p>
<hr>
<p><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://ws1.sinaimg.cn/large/d71f8b2fgy1fw934tx7mcj20b405kgno.jpg" alt title>
                </div>
                <div class="image-caption"></div>
            </figure></p>

      

          <a href="/posts/PythonWorldFrequency.html" class="post-more waves-effect waves-button">
            <i class="icon icon-bookmark">&nbsp;</i> 阅读全文…
          </a>
      </div>
      
      <div class="post-footer">
          
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Note/">Note</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebCrawler/">WebCrawler</a></li></ul>

      </div>
      
  </article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-PythonRegex"
    class="article-card article-type-post" itemprop="blogPost">

      <div class="post-meta">
          <time class="post-time" title="2018-10-12 15:28:26" datetime="2018-10-12T07:28:26.000Z"  itemprop="datePublished"><i class="icon icon-calendar"></i> 2018-10-12</time>

          
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Coding/">Coding</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Coding/Python/">Python</a></li></ul></li></ul>



          
      </div>

      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/posts/PythonRegex.html">Python 正则表达式</a>
    </h3>
  



      <div class="post-content" id="post-content" itemprop="postContent">

      
          <p>Python 正则表达式
&lt;!--more--&gt;</p>
<h1>常见匹配模式</h1>
<ul>
<li>模式表</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">模式</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>\w</code></td>
<td style="text-align:left">匹配字母数字及下划线</td>
</tr>
<tr>
<td style="text-align:left"><code>\W</code></td>
<td style="text-align:left">匹配非字母数字下划线</td>
</tr>
<tr>
<td style="text-align:left"><code>\s</code></td>
<td style="text-align:left">匹配任意空白字符，等价于 [\t\n\r\f].</td>
</tr>
<tr>
<td style="text-align:left"><code>\S</code></td>
<td style="text-align:left">匹配任意非空字符</td>
</tr>
<tr>
<td style="text-align:left"><code>\d</code></td>
<td style="text-align:left">匹配任意数字，等价于 [0-9]</td>
</tr>
<tr>
<td style="text-align:left"><code>\D</code></td>
<td style="text-align:left">匹配任意非数字</td>
</tr>
<tr>
<td style="text-align:left"><code>\A</code></td>
<td style="text-align:left">匹配字符串开始</td>
</tr>
<tr>
<td style="text-align:left"><code>\Z</code></td>
<td style="text-align:left">匹配字符串结束，如果是存在换行，只匹配到换行前的结束字符串</td>
</tr>
<tr>
<td style="text-align:left"><code>\z</code></td>
<td style="text-align:left">匹配字符串结束</td>
</tr>
<tr>
<td style="text-align:left"><code>\G</code></td>
<td style="text-align:left">匹配最后匹配完成的位置</td>
</tr>
<tr>
<td style="text-align:left"><code>\n</code></td>
<td style="text-align:left">匹配一个换行符</td>
</tr>
<tr>
<td style="text-align:left"><code>\t</code></td>
<td style="text-align:left">匹配一个制表符</td>
</tr>
<tr>
<td style="text-align:left"><code>^</code></td>
<td style="text-align:left">匹配字符串的开头</td>
</tr>
<tr>
<td style="text-align:left"><code>$</code></td>
<td style="text-align:left">匹配字符串的末尾</td>
</tr>
<tr>
<td style="text-align:left"><code>.</code></td>
<td style="text-align:left">匹配任意字符，除了换行符，当re.DOTALL标记被指定时，则可以匹配包括换行符的任意字符</td>
</tr>
<tr>
<td style="text-align:left"><code>[...]</code></td>
<td style="text-align:left">用来表示一组字符,单独列出：[amk] 匹配 'a'，'m'或'k'</td>
</tr>
<tr>
<td style="text-align:left"><code>[^...]</code></td>
<td style="text-align:left">不在[]中的字符：[^abc] 匹配除了a,b,c之外的字符</td>
</tr>
<tr>
<td style="text-align:left"><code>*</code></td>
<td style="text-align:left">匹配0个或多个的表达式</td>
</tr>
<tr>
<td style="text-align:left"><code>+</code></td>
<td style="text-align:left">匹配1个或多个的表达式</td>
</tr>
<tr>
<td style="text-align:left"><code>?</code></td>
<td style="text-align:left">匹配0个或1个由前面的正则表达式定义的片段，非贪婪方式</td>
</tr>
<tr>
<td style="text-align:left"><code>{n}</code></td>
<td style="text-align:left">精确匹配n个前面表达式</td>
</tr>
<tr>
<td style="text-align:left"><code>{n, m}</code></td>
<td style="text-align:left">匹配 n 到 m 次由前面的正则表达式定义的片段，贪婪方式</td>
</tr>
<tr>
<td style="text-align:left"><code>a|b</code></td>
<td style="text-align:left">匹配a或b</td>
</tr>
<tr>
<td style="text-align:left"><code>( )</code></td>
<td style="text-align:left">匹配括号内的表达式，也表示一个组</td>
</tr>
</tbody>
</table>
<h1>re.match</h1>
<p>re.match 尝试从字符串的起始位置匹配一个模式，如果不是起始位置匹配成功的话，match()就返回none。</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re.match(pattern, string, flags=<span class="number">0</span>)</span><br></pre></td></tr></table></figure></p>
<h2>匹配模式</h2>
<ul>
<li>最常规的匹配</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Hello 123 4567 World_This is a Regex Demo'</span></span><br><span class="line">print(len(content))</span><br><span class="line"></span><br><span class="line"><span class="comment">#逐个匹配单个字符</span></span><br><span class="line">result = re.match(<span class="string">'^Hello\s\d\d\d\s\d&#123;4&#125;\s\w&#123;10&#125;.*Demo$'</span>,content)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment">#输出匹配的字符串</span></span><br><span class="line">print(result.group())</span><br><span class="line"><span class="comment">#输出匹配字符长度</span></span><br><span class="line">print(result.span())</span><br></pre></td></tr></table></figure></p>
<h2>泛匹配</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Hello 123 4567 World_This is a Regex Demo'</span></span><br><span class="line"><span class="comment">#用.*代表任意个任何字符</span></span><br><span class="line">result = re.match(<span class="string">'^Hello.*Demo$'</span>,content)</span><br><span class="line"><span class="comment">#输出整个匹配结果</span></span><br><span class="line">print(result)</span><br><span class="line"><span class="comment">#输出匹配的字符串</span></span><br><span class="line">print(result.group())</span><br><span class="line"><span class="comment">#输出匹配字符长度</span></span><br><span class="line">print(result.span())</span><br></pre></td></tr></table></figure></p>
<h2>匹配目标</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Hello 1234567 World_This is a Regex Demo'</span></span><br><span class="line"><span class="comment">#用()匹配目标1234567</span></span><br><span class="line">result = re.match(<span class="string">'^Hello\s(\d+)\sWorld.*Demo$'</span>,content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br><span class="line"><span class="comment">#输出匹配字符长度</span></span><br><span class="line">print(result.span())</span><br></pre></td></tr></table></figure></p>
<h2>贪婪匹配</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Hello 1234567 World_This is a Regex Demo'</span></span><br><span class="line"><span class="comment">#用.*模式尝试匹配数字串1234567</span></span><br><span class="line">result = re.match(<span class="string">'^He.*\s(\d+)\sWorld.*Demo$'</span>,content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br></pre></td></tr></table></figure></p>
<h2>非贪婪匹配</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Hello 1234567 World_This is a Regex Demo'</span></span><br><span class="line"><span class="comment">#用.*？模式匹配数字串1234567</span></span><br><span class="line">result = re.match(<span class="string">'^H.*?\s(\d+)\sW.*?Demo$'</span>,content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br></pre></td></tr></table></figure></p>
<h2>匹配模式</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'''Hello 1234567 World_This</span></span><br><span class="line"><span class="string">is a Regex Demo</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment">#用re.S意味着.可以代表换行符在内的符号</span></span><br><span class="line">print(result.group(<span class="number">1</span>))<span class="comment">#输出匹配数字串</span></span><br><span class="line">result = re.match(<span class="string">'He.*?\s(\d+).*?Demo$'</span>,content,re.S)</span><br></pre></td></tr></table></figure></p>
<h1>转义</h1>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'price is $5.00'</span></span><br><span class="line"><span class="comment">#直接用$与.代表原字符</span></span><br><span class="line">result = re.match(<span class="string">'price is $5.00'</span>,content)</span><br><span class="line">print(result)<span class="comment">#输出匹配结果</span></span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'price is $5.00'</span></span><br><span class="line"><span class="comment">#加\代表转义</span></span><br><span class="line">result = re.match(<span class="string">'price is \$5\.00'</span>,content)</span><br><span class="line">print(result)<span class="comment">#输出整个匹配结果</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>总结：尽量使用泛匹配、使用括号得到匹配目标、尽量使用非贪婪模式、有换行符就用re.S</li>
</ul>
<h1>re.search</h1>
<p>re.search 扫描整个字符串并返回第一个成功的匹配。</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Extra stings Hello 1234567 World_This is a Regex Demo Extra stings'</span></span><br><span class="line"><span class="comment">#用re.match匹配以Hello开头至Demo的这一段字符串</span></span><br><span class="line">result = re.match(<span class="string">'Hello.*?(\d+).*?Demo$'</span>,content)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Extra stings Hello 1234567 World_This is a Regex Demo Extra stings'</span></span><br><span class="line"><span class="comment">#用re.search匹配以Hello开头至Demo的这一段字符串</span></span><br><span class="line">result = re.search(<span class="string">'Hello.*?(\d+).*?Demo'</span>, content)</span><br><span class="line">print(result)<span class="comment">#输出整个匹配结果</span></span><br><span class="line">print(result.group(<span class="number">1</span>))<span class="comment">#输出数字字符串</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>总结：为匹配方便，能用 search 就不用 match</li>
</ul>
<h1>匹配演练</h1>
<ul>
<li>一</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''&lt;div id="songs-list"&gt;</span></span><br><span class="line"><span class="string">    &lt;h2 class="title"&gt;经典老歌&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;p class="introduction"&gt;</span></span><br><span class="line"><span class="string">        经典老歌列表</span></span><br><span class="line"><span class="string">    &lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;ul id="list" class="list-group"&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="2"&gt;一路上有你&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="7"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/2.mp3" singer="任贤齐"&gt;沧海一声笑&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="4" class="active"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/3.mp3" singer="齐秦"&gt;往事随风&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="6"&gt;&lt;a href="/4.mp3" singer="beyond"&gt;光辉岁月&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;&lt;a href="/5.mp3" singer="陈慧琳"&gt;记事本&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/6.mp3" singer="邓丽君"&gt;&lt;i class="fa fa-user"&gt;&lt;/i&gt;但愿人长久&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;'''</span></span><br><span class="line"><span class="comment">#分别匹配齐秦，往事随风这两串目标字符串</span></span><br><span class="line">result = re.search(<span class="string">'&lt;li.*?active.*?singer="(\w+)"&gt;(\w+)&lt;/a&gt;'</span>,html,re.S)</span><br><span class="line">print(result.group(<span class="number">1</span>),result.group(<span class="number">2</span>))</span><br></pre></td></tr></table></figure></p>
<ul>
<li>二</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''&lt;div id="songs-list"&gt;</span></span><br><span class="line"><span class="string">    &lt;h2 class="title"&gt;经典老歌&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;p class="introduction"&gt;</span></span><br><span class="line"><span class="string">        经典老歌列表</span></span><br><span class="line"><span class="string">    &lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;ul id="list" class="list-group"&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="2"&gt;一路上有你&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="7"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/2.mp3" singer="任贤齐"&gt;沧海一声笑&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="4" class="active"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/3.mp3" singer="齐秦"&gt;往事随风&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="6"&gt;&lt;a href="/4.mp3" singer="beyond"&gt;光辉岁月&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;&lt;a href="/5.mp3" singer="陈慧琳"&gt;记事本&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/6.mp3" singer="邓丽君"&gt;但愿人长久&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;'''</span></span><br><span class="line">result = re.search(<span class="string">'&lt;li.*?singer="(\w+)"&gt;(\w+)&lt;/a&gt;'</span>,html,re.S)</span><br><span class="line"><span class="comment">#分别匹配任贤齐，沧海一声笑这两串目标字符串</span></span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br><span class="line">print(result.group(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#同时输出任贤齐，沧海一声笑这两串目标字符</span></span><br><span class="line">print(result.group(<span class="number">1</span>),result.group(<span class="number">2</span>))</span><br></pre></td></tr></table></figure></p>
<ul>
<li>三</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''&lt;div id="songs-list"&gt;</span></span><br><span class="line"><span class="string">    &lt;h2 class="title"&gt;经典老歌&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;p class="introduction"&gt;</span></span><br><span class="line"><span class="string">        经典老歌列表</span></span><br><span class="line"><span class="string">    &lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;ul id="list" class="list-group"&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="2"&gt;一路上有你&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="7"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/2.mp3" singer="任贤齐"&gt;沧海一声笑&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="4" class="active"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/3.mp3" singer="齐秦"&gt;往事随风&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="6"&gt;&lt;a href="/4.mp3" singer="beyond"&gt;光辉岁月&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;&lt;a href="/5.mp3" singer="陈慧琳"&gt;记事本&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/6.mp3" singer="邓丽君"&gt;但愿人长久&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;'''</span></span><br><span class="line">result = re.search(<span class="string">'&lt;li.*?singer="(\w+)"&gt;(\w+)&lt;/a&gt;'</span>,html)</span><br><span class="line"><span class="comment">#分别匹配beyond，光辉岁月这两串目标字符串</span></span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br><span class="line">print(result.group(<span class="number">2</span>))</span><br><span class="line"><span class="comment">#同时输出beyond，光辉岁月这两串目标字符串</span></span><br><span class="line">print(result.group(<span class="number">1</span>),result.group(<span class="number">2</span>))</span><br></pre></td></tr></table></figure></p>
<h1>re.findall</h1>
<p>搜索字符串，以列表形式返回全部能匹配的子串。</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''&lt;div id="songs-list"&gt;</span></span><br><span class="line"><span class="string">&lt;h2 class="title"&gt;经典老歌&lt;/h2&gt;</span></span><br><span class="line"><span class="string">&lt;p class="introduction"&gt;</span></span><br><span class="line"><span class="string">    经典老歌列表</span></span><br><span class="line"><span class="string">&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;ul id="list" class="list-group"&gt;</span></span><br><span class="line"><span class="string">    &lt;li data-view="2"&gt;一路上有你&lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;li data-view="7"&gt;</span></span><br><span class="line"><span class="string">        &lt;a href="/2.mp3" singer="任贤齐"&gt;沧海一声笑&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;li data-view="4" class="active"&gt;</span></span><br><span class="line"><span class="string">        &lt;a href="/3.mp3" singer="齐秦"&gt;往事随风&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;li data-view="6"&gt;&lt;a href="/4.mp3" singer="beyond"&gt;光辉岁月&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;li data-view="5"&gt;&lt;a href="/5.mp3" singer="陈慧琳"&gt;记事本&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;li data-view="5"&gt;</span></span><br><span class="line"><span class="string">        &lt;a href="/6.mp3" singer="邓丽君"&gt;但愿人长久&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;/li&gt;</span></span><br><span class="line"><span class="string">&lt;/ul&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;'''</span></span><br><span class="line"><span class="comment">#匹配从任贤齐开始所有歌的href,singer值与文本内容</span></span><br><span class="line">result = re.findall(<span class="string">'&lt;li.*?href="(.*?)".*?singer="(\w+)"&gt;(\w+)&lt;/a&gt;'</span>,html,re.S)</span><br><span class="line">print(result)<span class="comment">#输出整个匹配结果</span></span><br><span class="line">print(type(result))<span class="comment">#输出匹配结果的数据类型</span></span><br><span class="line"><span class="comment">#遍历所有匹配结果，输出每一条匹配结果与每一匹配结果的三个元素</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> result :</span><br><span class="line">    print(result)</span><br><span class="line">    print(item[<span class="number">0</span>],item[<span class="number">1</span>],item[<span class="number">2</span>])</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''&lt;div id="songs-list"&gt;</span></span><br><span class="line"><span class="string">    &lt;h2 class="title"&gt;经典老歌&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;p class="introduction"&gt;</span></span><br><span class="line"><span class="string">        经典老歌列表</span></span><br><span class="line"><span class="string">    &lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;ul id="list" class="list-group"&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="2"&gt;一路上有你&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="7"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/2.mp3" singer="任贤齐"&gt;沧海一声笑&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="4" class="active"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/3.mp3" singer="齐秦"&gt;往事随风&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="6"&gt;&lt;a href="/4.mp3" singer="beyond"&gt;光辉岁月&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;&lt;a href="/5.mp3" singer="陈慧琳"&gt;记事本&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/6.mp3" singer="邓丽君"&gt;但愿人长久&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;'''</span></span><br><span class="line"><span class="comment">#用正则表达式匹配从一路上有你所在li标签开始的所有li标签</span></span><br><span class="line">result = re.findall(<span class="string">'&lt;li.*?&gt;\s*?(&lt;a.*?&gt;)?(\w+)(&lt;/a&gt;)?\s*?&lt;/li&gt;'</span>, html, re.S)</span><br><span class="line">print(result)<span class="comment">#输出整个匹配结果</span></span><br><span class="line"><span class="comment">##输出每一条匹配结果的第2个元素</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> result:</span><br><span class="line">    print(item[<span class="number">1</span>])</span><br></pre></td></tr></table></figure></p>
<h1>re.sub</h1>
<p>替换字符串中每一个匹配的子串后返回替换后的字符串。</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Extra stings Hello 1234567 World_This is a Regex Demo Extra stings'</span></span><br><span class="line"><span class="comment">#将数字1234567替换为空</span></span><br><span class="line">content = re.sub(<span class="string">'\d+'</span>,<span class="string">''</span>, content)</span><br><span class="line">print(content)<span class="comment">#输出替换结果</span></span><br></pre></td></tr></table></figure></p>
<pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Extra stings Hello 1234567 World_This is a Regex Demo Extra stings'</span></span><br><span class="line"><span class="comment">#将数字1234567替换为字符串“Replacement”</span></span><br><span class="line">content = re.sub(<span class="string">'\d+'</span>,<span class="string">'Replacement'</span>,content)</span><br><span class="line">print(content)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Extra stings Hello 1234567 World_This is a Regex Demo Extra stings'</span></span><br><span class="line"><span class="comment">#将数字1234567替换为1234567 8910</span></span><br><span class="line">content = re.sub(<span class="string">'(\d+)'</span>, <span class="string">r'\1 8910'</span>, content)</span><br><span class="line">print(content)<span class="comment">#输出替换结果</span></span><br></pre></td></tr></table></figure>
</code></pre>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''&lt;div id="songs-list"&gt;</span></span><br><span class="line"><span class="string">    &lt;h2 class="title"&gt;经典老歌&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;p class="introduction"&gt;</span></span><br><span class="line"><span class="string">        经典老歌列表</span></span><br><span class="line"><span class="string">    &lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;ul id="list" class="list-group"&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="2"&gt;一路上有你&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="7"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/2.mp3" singer="任贤齐"&gt;沧海一声笑&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="4" class="active"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/3.mp3" singer="齐秦"&gt;往事随风&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="6"&gt;&lt;a href="/4.mp3" singer="beyond"&gt;光辉岁月&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;&lt;a href="/5.mp3" singer="陈慧琳"&gt;记事本&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/6.mp3" singer="邓丽君"&gt;但愿人长久&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;'''</span></span><br><span class="line"><span class="comment">#去除a类标签（用re.sub方法提取所有歌名，提示思路：先去除a类型标签，再用正则提取每个li标签的内容）</span></span><br><span class="line">html = re.sub(<span class="string">'&lt;a.*?&gt;|&lt;/a&gt;'</span>,<span class="string">''</span>,html)</span><br><span class="line">print(html)<span class="comment">#输出去除结果</span></span><br><span class="line"><span class="comment">#正则匹配li标签内容</span></span><br><span class="line">result = re.findall(<span class="string">'li.*?&gt;(.*?)&lt;/li&gt;'</span>,html,re.S)</span><br><span class="line">print(result)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> result:<span class="comment">#遍历每一匹配结果</span></span><br><span class="line">    print(item.strip())<span class="comment">#输出每一匹配结果并去除换行符</span></span><br></pre></td></tr></table></figure></p>
<h1>re.compile</h1>
<ol>
<li>将正则字符串编译成正则表达式对象</li>
<li>将一个正则表达式串编译成正则对象，以便于复用该匹配模式</li>
</ol>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'''Hello 1234567 World_This</span></span><br><span class="line"><span class="string">is a Regex Demo'''</span></span><br><span class="line"><span class="comment">#编写Hello开始的这一串字符串匹配模式pattern</span></span><br><span class="line">pattern = re.compile(<span class="string">'Hello.*?Demo'</span>,re.S)</span><br><span class="line"><span class="comment">#用上述模式匹配</span></span><br><span class="line">result = re.match(pattern,content)</span><br><span class="line"><span class="comment">#result = re.match('Hello.*Demo', content, re.S)</span></span><br><span class="line">print(result)<span class="comment">#输出匹配结果</span></span><br></pre></td></tr></table></figure></p>
<h1>练习题</h1>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">content = requests.get(<span class="string">'https://book.douban.com/'</span>).text</span><br><span class="line">pattern = re.compile(<span class="string">'&lt;li.*?cover.*?href="(.*?)".*?title="(.*?)".*?more-meta.*?author"&gt;(.*?)&lt;/span&gt;.*?year"&gt;(.*?)&lt;/span&gt;.*?&lt;/li&gt;'</span>, re.S)</span><br><span class="line"><span class="comment">#利用上述pattern匹配所有书籍的上述信息</span></span><br><span class="line">results = re.findall(pattern, content)</span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">    <span class="comment">#分别用url,title,author,date为每一书籍信息的变量名</span></span><br><span class="line">    url, name, author, date = result</span><br><span class="line">    <span class="comment">#将author后面的\n替换为空</span></span><br><span class="line">    author = re.sub(<span class="string">'\s'</span>, <span class="string">''</span>, author)</span><br><span class="line">    <span class="comment">#将date后面的\n替换为空</span></span><br><span class="line">    date = re.sub(<span class="string">'\s'</span>, <span class="string">''</span>, date)</span><br><span class="line">    <span class="comment">#同时输出每一书籍url,title,author,date信息</span></span><br><span class="line">    print(url, name, author, date)</span><br></pre></td></tr></table></figure></p>

      

          <a href="/posts/PythonRegex.html" class="post-more waves-effect waves-button">
            <i class="icon icon-bookmark">&nbsp;</i> 阅读全文…
          </a>
      </div>
      
      <div class="post-footer">
          
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Note/">Note</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebCrawler/">WebCrawler</a></li></ul>

      </div>
      
  </article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-FTX"
    class="article-card article-type-post" itemprop="blogPost">

      <div class="post-meta">
          <time class="post-time" title="2018-10-11 09:25:45" datetime="2018-10-11T01:25:45.000Z"  itemprop="datePublished"><i class="icon icon-calendar"></i> 2018-10-11</time>

          
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Coding/">Coding</a></li></ul>



          
      </div>

      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/posts/FTX.html">房天下二手房</a>
    </h3>
  



      <div class="post-content" id="post-content" itemprop="postContent">

      
          <p>房天下爬虫
&lt;!--more--&gt;</p>
<h3>获取网页源码</h3>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment">#获取上海在售二手房源网页首页（http://esf.sh.fang.com/）的响应包，命名为res</span></span><br><span class="line">res.text</span><br><span class="line">res = requests.get(<span class="string">'http://esf.sh.fang.com/'</span>)</span><br><span class="line"><span class="comment">#输出res的文本内容</span></span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure></p>
<h3>获取每套房源的详细内容页</h3>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="comment">#将上海在售二手房源网页首页url（http://esf.sh.fang.com/）赋值给domain</span></span><br><span class="line">domain = <span class="string">'http://esf.sh.fang.com'</span></span><br><span class="line"><span class="comment"># 创建BeautifulSoup对象对res响应包进行解析，结果命名为soup</span></span><br><span class="line">soup = BeautifulSoup(res.text,<span class="string">'html.parser'</span>)</span><br><span class="line"><span class="comment"># 循环遍历获取网页首页所有房源详细内容页的url,循环变量名为house（提示：检查定位路径定位查找的节点是否为空）</span></span><br><span class="line"><span class="keyword">for</span> house <span class="keyword">in</span> soup.select(<span class="string">'.shop_list dl dd h4 a'</span>):</span><br><span class="line">    <span class="comment">#（提示：如果存在返回的标签节点有空的情况，需要进行判断！）</span></span><br><span class="line">    <span class="keyword">if</span> house:</span><br><span class="line">        <span class="comment"># 利用domain与存储房屋详细内容的相对url的标签节点构建房屋的 url</span></span><br><span class="line">        print(domain+house[<span class="string">'href'</span>])</span><br><span class="line">        <span class="comment"># 打印输出查看url</span></span><br><span class="line">        print(<span class="string">'========================'</span></span><br></pre></td></tr></table></figure></p>
<h3>将上面获取到的其中一房源的详细内容页的 url 进行请求并解析提取相关数据</h3>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="comment"># 将以上获得的第一个房源的详细内容页进行请求访问</span></span><br><span class="line">res =requests.get(<span class="string">'http://esf.sh.fang.com/chushou/3_331876564.htm'</span>)</span><br><span class="line"><span class="comment"># 对响应包res的网页文本进行解析，解析结果命名为soup</span></span><br><span class="line">soup = BeautifulSoup(res.text,<span class="string">'html.parser'</span>)</span><br><span class="line">res.text</span><br></pre></td></tr></table></figure></p>
<h3>获取详情</h3>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义字典变量info，用于存放每套房子相关数据</span></span><br><span class="line">info =&#123;&#125;</span><br><span class="line"><span class="comment"># 查找房子标题，以“标题”为key名存入info</span></span><br><span class="line">info[<span class="string">'标题'</span>]=soup.select(<span class="string">'.title h1'</span>)[<span class="number">0</span>].text.strip()</span><br><span class="line">info</span><br><span class="line"></span><br><span class="line"><span class="comment">#查找总价，以“总价”为key名存入info</span></span><br><span class="line">info[<span class="string">'总价'</span>]=soup.select(<span class="string">'.price_esf'</span>)[<span class="number">0</span>].text</span><br><span class="line">info</span><br><span class="line"></span><br><span class="line">k = [<span class="string">'总价'</span>,<span class="string">'单价'</span>,<span class="string">'建筑面积'</span>,<span class="string">'朝向'</span>,<span class="string">'楼层'</span>,<span class="string">'装修'</span>,<span class="string">'户型'</span>,<span class="string">'标题'</span>]</span><br><span class="line"><span class="comment">#item表示包括户型，朝向，单价，楼层，装修等相关数据的标签</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> soup.select(<span class="string">'.trl-item1'</span>):</span><br><span class="line">     <span class="comment"># key 计划用于表示房屋的字段</span></span><br><span class="line">     key=item.select(<span class="string">'.font14'</span>)[<span class="number">0</span>].text.strip()</span><br><span class="line">     <span class="comment"># value 计划用于表示房屋相关字段对应数</span></span><br><span class="line">     value=item.select(<span class="string">'.tt'</span>)[<span class="number">0</span>].text.strip()</span><br><span class="line">     info[key]=value</span><br><span class="line">print(info)</span><br><span class="line">print(list(info.values()))</span><br><span class="line">print(k)</span><br><span class="line">print(dict(zip(k,list(info.values()))))</span><br></pre></td></tr></table></figure></p>
<h3>定义一个获取网页详细内容页的函数 getHouseDetail</h3>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getHouseDetail</span><span class="params">(url)</span>:</span></span><br><span class="line">    info=&#123;&#125;</span><br><span class="line">    info_adj=&#123;&#125;</span><br><span class="line">    <span class="comment"># 根据url请求网页内容</span></span><br><span class="line">    res=requests.get(url)</span><br><span class="line">    <span class="comment">#解析详细内容页，结果命名为soup</span></span><br><span class="line">    soup = BeautifulSoup(res.text,<span class="string">'html.parser'</span>)</span><br><span class="line">    <span class="comment"># 获取房屋名并加入info字典，key值命名为“标题</span></span><br><span class="line">    info[<span class="string">'标题'</span>]=soup.select(<span class="string">'.title h1'</span>)[<span class="number">0</span>].text.strip()</span><br><span class="line">    <span class="comment"># 获取房屋总价并加入info字典，key值命名为“总价</span></span><br><span class="line">    info[<span class="string">'总价'</span>]=soup.select(<span class="string">'.price_esf'</span>)[<span class="number">0</span>].text</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 用item做为循环变量名，代表当前网页class为trl-item1的所有标签节点</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> soup.select(<span class="string">'.trl-item1'</span>):</span><br><span class="line">        <span class="comment"># key表示item标签下所有class为font14的标签节点文本内容</span></span><br><span class="line">        key=item.select(<span class="string">'.font14'</span>)[<span class="number">0</span>].text.strip()</span><br><span class="line">        print(key)</span><br><span class="line">        <span class="comment"># value 示item标签下所有class为tt的标签节点文本内容</span></span><br><span class="line">        value=item.select(<span class="string">'.tt'</span>)[<span class="number">0</span>].text.strip()</span><br><span class="line">        <span class="comment">#将info里面所有key赋值给value</span></span><br><span class="line">        info[key]=value</span><br><span class="line">        k=[<span class="string">'总价'</span>,<span class="string">'单价'</span>,<span class="string">'建筑面积'</span>,<span class="string">'朝向'</span>,<span class="string">'楼层'</span>,<span class="string">'装修'</span>,<span class="string">'户型'</span>,<span class="string">'标题'</span>]</span><br><span class="line">    info_adj=dict(zip(k,list(info.values())))</span><br><span class="line">    <span class="comment">#print(info_adj)</span></span><br><span class="line">    <span class="keyword">return</span> info_adj</span><br></pre></td></tr></table></figure></p>
<h3>通过获取所有房屋的详细内容页 url，获取每一房屋的相关字段信息</h3>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">getHouseDetail(<span class="string">'http://esf.sh.fang.com/chushou/3_328597533.htm'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="comment"># 定义列表用于存储所有房屋的相关数据</span></span><br><span class="line">houseary=[]</span><br><span class="line"><span class="comment"># domain 为http://esf.sh.fang.com域名</span></span><br><span class="line">domain=<span class="string">'http://esf.sh.fang.com'</span></span><br><span class="line"><span class="comment"># 请求访问http://esf.sh.fang.com首页，获得响应包res</span></span><br><span class="line">res=requests.get(<span class="string">'http://esf.sh.fang.com'</span>)</span><br><span class="line"><span class="comment">#创建BeatifulSoup对象并进行解析</span></span><br><span class="line">soup=BeautifulSoup(res.text,<span class="string">'html.parser'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环遍历获取网页首页中存有的标签节点，循环变量命名为link</span></span><br><span class="line"><span class="keyword">for</span> link <span class="keyword">in</span> soup.select(<span class="string">'.shop_list dl dd h4 a'</span>):</span><br><span class="line">    <span class="comment"># 利用domain与存储房屋详细内容的相对url的标签节点构建房屋的url</span></span><br><span class="line">    url=domain+link[<span class="string">'href'</span>]</span><br><span class="line">    <span class="comment"># 调用getHouseDetail函数获取每一房屋相关数据并追加到houseary</span></span><br><span class="line">    houseary.append(getHouseDetail(url))</span><br><span class="line"></span><br><span class="line"><span class="comment">#求总共获取到多少套房屋信息</span></span><br><span class="line">len(houseary)</span><br></pre></td></tr></table></figure></p>
<h3>数据处理</h3>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas</span><br><span class="line"><span class="comment">#将获取到的所有房屋信息转换成数据框的结构</span></span><br><span class="line">df = pandas.DataFrame(houseary)</span><br><span class="line">df</span><br><span class="line"></span><br><span class="line"><span class="comment">#存储到当前工作空间目录下，文件命名为house.xlsx</span></span><br><span class="line">df.to_excel(<span class="string">'house.xlsx'</span>)</span><br></pre></td></tr></table></figure></p>

      

          <a href="/posts/FTX.html" class="post-more waves-effect waves-button">
            <i class="icon icon-bookmark">&nbsp;</i> 阅读全文…
          </a>
      </div>
      
      <div class="post-footer">
          
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Note/">Note</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebCrawler/">WebCrawler</a></li></ul>

      </div>
      
  </article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-PythonNumpy"
    class="article-card article-type-post" itemprop="blogPost">

      <div class="post-meta">
          <time class="post-time" title="2018-10-03 18:08:56" datetime="2018-10-03T10:08:56.000Z"  itemprop="datePublished"><i class="icon icon-calendar"></i> 2018-10-03</time>

          
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Coding/">Coding</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Coding/Python/">Python</a></li></ul></li></ul>



          
      </div>

      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/posts/PythonNumpy.html">Python Numpy</a>
    </h3>
  



      <div class="post-content" id="post-content" itemprop="postContent">

      
          <p>Python Numpy
&lt;!--more--&gt;</p>
<h1>问题</h1>
<h2>数列</h2>
<ul>
<li>a = a1,a2,a3,·····,an</li>
<li>b = b1,b2,b3,·····,bn</li>
<li>求：
<ul>
<li>c = a12+b13,a22+b23,a32+b33,·····+an2+bn3</li>
</ul>
<ol>
<li>用列表+循环实现，并包装成函数</li>
<li>用numpy实现，并包装成函数</li>
<li>对比两种方法实现的效率，给定一个较大的参数n，用运行函数前后的timedelta表示。</li>
</ol>
</li>
</ul>
<h1>实现</h1>
<h2>列表+循环实现，并包装成函数</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pySum</span><span class="params">(n)</span>:</span></span><br><span class="line">    a = list(range(n))</span><br><span class="line">    b = list(range(<span class="number">0</span>,<span class="number">5</span>*n,<span class="number">5</span>))</span><br><span class="line">    c = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">        c.append(a[i] ** <span class="number">2</span> + b[i] ** <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">return</span>(c)</span><br><span class="line">print(pySum(<span class="number">10</span>))</span><br></pre></td></tr></table></figure></p>
<h2>数组numpy实现，并包装成函数</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">npSum</span><span class="params">(n)</span>:</span></span><br><span class="line">    a = numpy.arange(n)</span><br><span class="line">    b = numpy.arange(<span class="number">0</span>, <span class="number">5</span> * n, <span class="number">5</span>)</span><br><span class="line">    c = a**<span class="number">2</span>+b**<span class="number">3</span></span><br><span class="line">    <span class="keyword">return</span>(c)</span><br><span class="line">print(npSum(<span class="number">10</span>))</span><br></pre></td></tr></table></figure></p>
<ul>
<li>对比两种方法实现的效率，给定一个较大的参数n，用运行函数前后的timedelta表示</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">start = datetime.now()</span><br><span class="line">pySum(<span class="number">100000</span>)</span><br><span class="line">delta = datetime.now()-start</span><br><span class="line">print(delta)</span><br><span class="line"></span><br><span class="line">start = datetime.now()</span><br><span class="line">npSum(<span class="number">100000</span>)</span><br><span class="line">delta = datetime.now()-start</span><br><span class="line">print(delta)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>尝试把 a,b 定义为三层嵌套列表和三维数组</li>
</ul>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">liSum</span><span class="params">(n)</span>:</span></span><br><span class="line">    a = numpy.arange(n)</span><br><span class="line">    b = numpy.arange(<span class="number">0</span>,<span class="number">5</span>*n,<span class="number">5</span>)</span><br><span class="line">    c = numpy.array([[a,b],[a**<span class="number">2</span>,b**<span class="number">3</span>]])</span><br><span class="line">    <span class="keyword">return</span> (c)</span><br><span class="line">print(npSum(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">start = datetime.now()</span><br><span class="line">liSum(<span class="number">100000</span>)</span><br><span class="line">time = datetime.now()-start</span><br><span class="line">print(time)</span><br></pre></td></tr></table></figure></p>

      

          <a href="/posts/PythonNumpy.html" class="post-more waves-effect waves-button">
            <i class="icon icon-bookmark">&nbsp;</i> 阅读全文…
          </a>
      </div>
      
      <div class="post-footer">
          
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Note/">Note</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      </div>
      
  </article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-JupyterTheme"
    class="article-card article-type-post" itemprop="blogPost">

      <div class="post-meta">
          <time class="post-time" title="2018-09-29 12:06:48" datetime="2018-09-29T04:06:48.000Z"  itemprop="datePublished"><i class="icon icon-calendar"></i> 2018-09-29</time>

          
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Diary/">Diary</a></li></ul>



          
      </div>

      


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/posts/JupyterTheme.html">Jupyter 主题</a>
    </h3>
  



      <div class="post-content" id="post-content" itemprop="postContent">

      
          <p>Jupyter 主题
&lt;!--more--&gt;</p>
<h1>安装 Jupyter-theme</h1>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install jupyterthemes</span><br></pre></td></tr></table></figure></p>
<h2>更换主题</h2>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jt -l <span class="comment"># 列出主题</span></span><br><span class="line">jt -t themeName <span class="comment"># 更换主题</span></span><br><span class="line">jt -r <span class="comment"># 恢复默认主题</span></span><br></pre></td></tr></table></figure></p>
<hr>
<p><strong>Jupyter-themes</strong></p>
<ul>
<li><a href="https://github.com/dunovank/jupyter-themes" target="_blank" rel="noopener">官方仓库</a></li>
</ul>

      

          <a href="/posts/JupyterTheme.html" class="post-more waves-effect waves-button">
            <i class="icon icon-bookmark">&nbsp;</i> 阅读全文…
          </a>
      </div>
      
      <div class="post-footer">
          
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Note/">Note</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebCrawler/">WebCrawler</a></li></ul>

      </div>
      
  </article>

        </li>
    
    </ul>

    
<nav id="page-nav">
    <div class="inner">
    <a class="extend prev" rel="prev" href="/page/7/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/9/">下一页</a>
    </div>
</nav>


</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/xml/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh_CN">CC BY-NC-SA 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Vitan &copy; 2017 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: false, REWARD: false };


</script>

<script src="//unpkg.com/indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '您似乎掉线了呢！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
